# Aura TUI - Terminal User Interface

> Interactive terminal interface for managing Aura tickets and observing agent activity

## Overview

The Aura TUI provides a rich terminal interface for interacting with the Aura Kubernetes management agent. It supports two operational modes:

1. **Client Mode**: Connects to a running Aura server via HTTP/SSE
2. **Standalone Mode**: Embeds the Aura server in-process for local use

## Goals

- Real-time visibility into agent activity and cluster state
- Quick ticket creation and management
- Streamlined approval workflows
- Audit log exploration
- Minimal dependencies, fast startup

## Technology Stack

| Component        | Technology                   | Rationale                                        |
| ---------------- | ---------------------------- | ------------------------------------------------ |
| TUI Framework    | Ink (React for CLI)          | Declarative UI, component reuse, familiar model  |
| Terminal Styling | Chalk                        | Bundled with Ink, consistent styling             |
| Input Handling   | Ink's built-in hooks         | useInput, useFocus, useApp                       |
| HTTP Client      | Native fetch                 | No external deps, streaming support              |
| SSE Client       | eventsource (or native)      | Server-Sent Events for real-time updates         |
| CLI Framework    | Commander                    | Argument parsing, subcommands                    |
| Config           | Shared with server (Convict) | Reuse existing config infrastructure             |

### Why Ink?

1. **React Mental Model**: Declarative, component-based UI familiar to most developers
2. **Rich Ecosystem**: Text input, select boxes, spinners, tables available
3. **TypeScript First**: Excellent type definitions
4. **Active Maintenance**: Regular updates, good community
5. **Flexible Rendering**: Can render to string for testing

### Alternatives Considered

| Library      | Pros                      | Cons                                   |
| ------------ | ------------------------- | -------------------------------------- |
| blessed      | Feature-rich, mature      | Complex API, callback-heavy, dated     |
| blessed-contrib | Dashboards, charts     | Depends on blessed, maintenance issues |
| terminal-kit | Comprehensive             | Large API surface, imperative          |
| enquirer     | Beautiful prompts         | Not for persistent UIs                 |
| Ink          | React model, composable   | Requires React knowledge               |

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CLI Entry                                   â”‚
â”‚                        (Commander + Config)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    Client Mode    â”‚           â”‚  Standalone Mode  â”‚
        â”‚  (HTTP + SSE)     â”‚           â”‚  (Embedded Server)â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                               â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                      API Abstraction                             â”‚
        â”‚              (AuraClient interface)                             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                        Ink App                                   â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
        â”‚  â”‚   Router    â”‚  â”‚   Store     â”‚  â”‚   Theme     â”‚             â”‚
        â”‚  â”‚  (Screens)  â”‚  â”‚  (State)    â”‚  â”‚  (Styles)   â”‚             â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
        â”‚                                                                  â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
        â”‚  â”‚                      Screens                                 â”‚â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚â”‚
        â”‚  â”‚  â”‚TicketListâ”‚ â”‚TicketViewâ”‚ â”‚CreateFormâ”‚ â”‚ AuditLog â”‚       â”‚â”‚
        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
        â”‚                                                                  â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
        â”‚  â”‚                     Components                               â”‚â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
        â”‚  â”‚  â”‚ Header â”‚ â”‚ Footer â”‚ â”‚ Table  â”‚ â”‚ Panel  â”‚ â”‚Spinner â”‚   â”‚â”‚
        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
        â”‚  â”‚  â”‚ Input  â”‚ â”‚ Select â”‚ â”‚ Badge  â”‚ â”‚ Modal  â”‚ â”‚ Toast  â”‚   â”‚â”‚
        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Operational Modes

### Client Mode (Default)

Connects to an existing Aura server:

```bash
# Connect to local server (default: http://localhost:3000)
aura tui

# Connect to remote server
aura tui --server https://aura.homelab.local

# With authentication (future)
aura tui --server https://aura.homelab.local --token $AURA_TOKEN
```

**Implementation**:
- Uses `fetch` for REST API calls
- Uses `EventSource` or custom SSE client for streaming
- Reconnects automatically on connection loss
- Shows connection status in UI

### Standalone Mode

Embeds the Aura server in the same process:

```bash
# Start with embedded server
aura tui --standalone

# With custom config
aura tui --standalone --config ./config/local.json
```

**Implementation**:
- Imports server components directly (no HTTP)
- Uses `ServiceContainer` to instantiate services
- Calls service methods directly instead of HTTP
- Database and git operations work normally
- Useful for single-user, local development

```typescript
// Simplified standalone initialization
import { createServiceContainer } from '../services/services.ts';
import { loadConfig } from '../config/config.ts';

const config = loadConfig();
const services = await createServiceContainer(config);

// TUI uses services directly
const tickets = await services.tickets.list();
```

## CLI Commands

```
aura tui [options]           Launch interactive TUI

Options:
  -s, --server <url>         Server URL (default: http://localhost:3000)
  -S, --standalone           Run with embedded server
  -c, --config <path>        Config file path (standalone mode)
  --no-color                 Disable colors
  --debug                    Enable debug logging

aura tickets                 Quick ticket operations (non-interactive)
  aura tickets list          List all tickets
  aura tickets show <id>     Show ticket details
  aura tickets create        Create ticket (opens editor)
  aura tickets approve <id>  Approve pending plan/action

aura status                  Show server status and stats
```

## Screen Layouts

### Main Dashboard (Ticket List)

```
â”Œâ”€ Aura â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ğŸŸ¢ Connected â”€â”
â”‚                                                                       â”‚
â”‚  Tickets                                                    [N]ew    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â”‚ ID       â”‚ Title                      â”‚ Status      â”‚ Updated   â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ abc123   â”‚ Deploy redis cluster       â”‚ â— Executing â”‚ 2m ago    â”‚ â”‚
â”‚  â”‚ def456   â”‚ Debug ingress 503 errors   â”‚ â— Approval  â”‚ 15m ago   â”‚ â”‚
â”‚  â”‚ ghi789   â”‚ Add prometheus monitoring  â”‚ â—‹ Planning  â”‚ 1h ago    â”‚ â”‚
â”‚  â”‚ jkl012   â”‚ Upgrade cert-manager       â”‚ âœ“ Resolved  â”‚ 2d ago    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  â†‘/â†“ Navigate  Enter View  n New  a Approve  q Quit  ? Help         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ticket Detail View

```
â”Œâ”€ Ticket: abc123 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â— Executing â”€â”
â”‚                                                                       â”‚
â”‚  Deploy redis cluster                                                â”‚
â”‚  Created: 2024-01-15 14:30 UTC    Updated: 2 minutes ago             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                       â”‚
â”‚  Description                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Deploy a 3-node Redis cluster in the data namespace with:      â”‚ â”‚
â”‚  â”‚ - Sentinel for HA                                               â”‚ â”‚
â”‚  â”‚ - 1Gi persistent storage per node                               â”‚ â”‚
â”‚  â”‚ - Expose via ClusterIP service                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  Plan (Approved)                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. Create data namespace if not exists                         â”‚ â”‚
â”‚  â”‚ 2. Generate Redis StatefulSet with 3 replicas                  â”‚ â”‚
â”‚  â”‚ 3. Configure Sentinel sidecar containers                       â”‚ â”‚
â”‚  â”‚ 4. Create PVCs with 1Gi storage                                â”‚ â”‚
â”‚  â”‚ 5. Create headless Service for pod discovery                   â”‚ â”‚
â”‚  â”‚ 6. Push changes and wait for ArgoCD sync                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  Activity                                                  [A]udit   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  14:35 â— git_commit: "Add redis StatefulSet manifests"              â”‚
â”‚  14:35 â— git_push: Pushed to origin/aura/ticket-abc123              â”‚
â”‚  14:36 â—‹ argo_sync: Waiting for sync... (2/3 resources ready)       â”‚
â”‚                                                                       â”‚
â”‚  Esc Back  a Approve  c Cancel  r Resume  l Logs  ? Help            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Approval Modal

```
â”Œâ”€ Approval Required â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                       â”‚
â”‚  âš   The agent requests approval for the following action:           â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Action: Delete and recreate PVC                                 â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ Reason: The existing PVC is bound to a failed PV. Recreating   â”‚ â”‚
â”‚  â”‚ will provision fresh storage. Data in the old PVC will be      â”‚ â”‚
â”‚  â”‚ lost.                                                           â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚ Resources affected:                                             â”‚ â”‚
â”‚  â”‚   - pvc/redis-data-0 (data namespace)                          â”‚ â”‚
â”‚  â”‚   - pv/pvc-abc123                                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚                              [Approve]  [Deny]  [Cancel]             â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Create Ticket Form

```
â”Œâ”€ Create Ticket â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                       â”‚
â”‚  Title                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Configure ingress for new API service                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  Description                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Set up nginx ingress for the new user-api service:             â”‚ â”‚
â”‚  â”‚ - Host: api.homelab.local                                       â”‚ â”‚
â”‚  â”‚ - TLS with Let's Encrypt                                        â”‚ â”‚
â”‚  â”‚ - Rate limiting: 100 req/min                                    â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  Priority   â—‹ Low  â— Medium  â—‹ High  â—‹ Critical                     â”‚
â”‚                                                                       â”‚
â”‚                                    [Create]  [Cancel]                â”‚
â”‚                                                                       â”‚
â”‚  Tab Next field  Shift+Tab Previous  Ctrl+Enter Submit              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Audit Log View

```
â”Œâ”€ Audit Log: abc123 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                       â”‚
â”‚  Filter: [All Events â–¾]  Search: [________________]                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                       â”‚
â”‚  14:36:42  tool_called      agent                                    â”‚
â”‚            â”œâ”€ Tool: kubectl_get                                      â”‚
â”‚            â”œâ”€ Args: {"resource": "pods", "namespace": "data"}        â”‚
â”‚            â””â”€ Result: Found 3 pods (redis-0, redis-1, redis-2)       â”‚
â”‚                                                                       â”‚
â”‚  14:36:38  argo_sync_started  agent                                  â”‚
â”‚            â”œâ”€ App: infrastructure                                    â”‚
â”‚            â””â”€ Revision: abc123f                                       â”‚
â”‚                                                                       â”‚
â”‚  14:35:55  push_executed    agent                                    â”‚
â”‚            â”œâ”€ Branch: aura/ticket-abc123                             â”‚
â”‚            â””â”€ SHA: abc123f                                            â”‚
â”‚                                                                       â”‚
â”‚  14:35:52  commit_created   agent                                    â”‚
â”‚            â”œâ”€ Message: "Add redis StatefulSet manifests"             â”‚
â”‚            â””â”€ Reasoning: "Creating the core Redis deployment..."     â”‚
â”‚                                                                       â”‚
â”‚  â†‘/â†“ Scroll  / Search  f Filter  Esc Back                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Library

### Core Components

```typescript
// Box with border and title
<Panel title="Tickets" footer="â†‘/â†“ Navigate">
  <TicketTable tickets={tickets} />
</Panel>

// Status badge with color
<Badge status="executing" />  // â— Executing (yellow)
<Badge status="resolved" />   // âœ“ Resolved (green)
<Badge status="failed" />     // âœ— Failed (red)

// Keyboard shortcut hint
<Shortcut key="n" label="New" />
<Shortcut key="Enter" label="View" />

// Loading spinner with message
<Spinner label="Syncing with ArgoCD..." />

// Toast notification
<Toast type="success" message="Ticket created" />
<Toast type="error" message="Connection lost" />

// Modal dialog
<Modal title="Confirm" onClose={handleClose}>
  <Text>Are you sure?</Text>
  <Button onClick={handleConfirm}>Yes</Button>
</Modal>

// Data table with selection
<Table
  columns={[
    { key: 'id', label: 'ID', width: 10 },
    { key: 'title', label: 'Title', flex: 1 },
    { key: 'status', label: 'Status', width: 12 },
  ]}
  data={tickets}
  selectedIndex={selectedIndex}
  onSelect={handleSelect}
/>

// Text input
<TextInput
  label="Title"
  value={title}
  onChange={setTitle}
  placeholder="Enter ticket title..."
/>

// Multi-line text area
<TextArea
  label="Description"
  value={description}
  onChange={setDescription}
  rows={6}
/>

// Select/dropdown
<Select
  label="Priority"
  value={priority}
  options={['low', 'medium', 'high', 'critical']}
  onChange={setPriority}
/>
```

### Hooks

```typescript
// Global keyboard shortcuts
useGlobalShortcuts({
  'q': () => exit(),
  '?': () => showHelp(),
  'n': () => navigate('/tickets/new'),
});

// Screen-specific shortcuts
useScreenShortcuts({
  'Enter': () => viewTicket(selectedId),
  'a': () => approveTicket(selectedId),
});

// API client
const { data, loading, error, refetch } = useApi('/api/tickets');

// SSE subscription
const events = useStream(`/api/tickets/${id}/stream`);

// Navigation
const { navigate, goBack, currentRoute } = useNavigation();

// Focus management
const { focusNext, focusPrev, focusedId } = useFocusManager();
```

## State Management

Simple React state with context for global state:

```typescript
type AppState = {
  // Connection
  connected: boolean;
  serverUrl: string;

  // Navigation
  currentScreen: Screen;
  screenParams: Record<string, string>;

  // Data
  tickets: Ticket[];
  selectedTicketId: string | null;

  // UI
  modal: ModalState | null;
  toast: ToastState | null;
};

type AppAction =
  | { type: 'SET_CONNECTED'; connected: boolean }
  | { type: 'NAVIGATE'; screen: Screen; params?: Record<string, string> }
  | { type: 'SET_TICKETS'; tickets: Ticket[] }
  | { type: 'UPDATE_TICKET'; ticket: Ticket }
  | { type: 'SELECT_TICKET'; id: string | null }
  | { type: 'SHOW_MODAL'; modal: ModalState }
  | { type: 'HIDE_MODAL' }
  | { type: 'SHOW_TOAST'; toast: ToastState }
  | { type: 'HIDE_TOAST' };

// Context provider
<AppProvider initialState={initialState}>
  <App />
</AppProvider>
```

## API Abstraction

Unified interface for both client and standalone modes:

```typescript
type AuraClient = {
  // Tickets
  listTickets(filters?: TicketFilters): Promise<Ticket[]>;
  getTicket(id: string): Promise<Ticket>;
  createTicket(data: CreateTicketInput): Promise<Ticket>;
  updateTicket(id: string, data: UpdateTicketInput): Promise<Ticket>;
  cancelTicket(id: string): Promise<void>;

  // Approvals & Input
  approvePlan(id: string): Promise<void>;
  approveAction(id: string, approved: boolean): Promise<void>;
  answerQuestion(id: string, answer: string): Promise<void>;
  resumeTicket(id: string, additionalTurns?: number): Promise<void>;

  // Agent
  runAgent(ticketId: string): Promise<void>;

  // Audit
  getAuditLog(ticketId: string): Promise<AuditLogEntry[]>;

  // Streaming
  subscribeToTicket(id: string, handler: EventHandler): Unsubscribe;
  subscribeToAll(handler: EventHandler): Unsubscribe;

  // Health
  getHealth(): Promise<HealthStatus>;
  getStats(): Promise<Stats>;
};

// HTTP implementation
class HttpAuraClient implements AuraClient {
  constructor(private baseUrl: string) {}

  async listTickets(filters?: TicketFilters): Promise<Ticket[]> {
    const params = new URLSearchParams(filters);
    const response = await fetch(`${this.baseUrl}/api/tickets?${params}`);
    return response.json();
  }

  subscribeToTicket(id: string, handler: EventHandler): Unsubscribe {
    const eventSource = new EventSource(`${this.baseUrl}/api/tickets/${id}/stream`);
    eventSource.onmessage = (event) => handler(JSON.parse(event.data));
    return () => eventSource.close();
  }
  // ...
}

// Standalone implementation
class StandaloneAuraClient implements AuraClient {
  constructor(private services: ServiceContainer) {}

  async listTickets(filters?: TicketFilters): Promise<Ticket[]> {
    return this.services.tickets.list(filters);
  }

  subscribeToTicket(id: string, handler: EventHandler): Unsubscribe {
    // Direct event emitter subscription
    return this.services.events.subscribe(id, handler);
  }
  // ...
}
```

## File Structure

```
src/
â”œâ”€â”€ tui/
â”‚   â”œâ”€â”€ tui.ts                    # TUI entry point
â”‚   â”œâ”€â”€ tui.cli.ts                # Commander CLI setup
â”‚   â”œâ”€â”€ tui.app.tsx               # Root Ink component
â”‚   â”‚
â”‚   â”œâ”€â”€ client/
â”‚   â”‚   â”œâ”€â”€ client.ts             # AuraClient interface
â”‚   â”‚   â”œâ”€â”€ client.http.ts        # HTTP implementation
â”‚   â”‚   â””â”€â”€ client.standalone.ts  # Embedded server implementation
â”‚   â”‚
â”‚   â”œâ”€â”€ state/
â”‚   â”‚   â”œâ”€â”€ state.ts              # State types and reducer
â”‚   â”‚   â”œâ”€â”€ state.context.tsx     # React context provider
â”‚   â”‚   â””â”€â”€ state.actions.ts      # Action creators
â”‚   â”‚
â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”œâ”€â”€ screens.ts            # Screen registry and router
â”‚   â”‚   â”œâ”€â”€ screen.dashboard.tsx  # Ticket list (main screen)
â”‚   â”‚   â”œâ”€â”€ screen.ticket.tsx     # Ticket detail view
â”‚   â”‚   â”œâ”€â”€ screen.create.tsx     # Create ticket form
â”‚   â”‚   â”œâ”€â”€ screen.audit.tsx      # Audit log viewer
â”‚   â”‚   â””â”€â”€ screen.help.tsx       # Help/keyboard shortcuts
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ component.panel.tsx   # Bordered box with title
â”‚   â”‚   â”œâ”€â”€ component.table.tsx   # Data table
â”‚   â”‚   â”œâ”€â”€ component.badge.tsx   # Status badge
â”‚   â”‚   â”œâ”€â”€ component.modal.tsx   # Modal dialog
â”‚   â”‚   â”œâ”€â”€ component.toast.tsx   # Toast notifications
â”‚   â”‚   â”œâ”€â”€ component.input.tsx   # Text input
â”‚   â”‚   â”œâ”€â”€ component.textarea.tsx # Multi-line input
â”‚   â”‚   â”œâ”€â”€ component.select.tsx  # Dropdown select
â”‚   â”‚   â”œâ”€â”€ component.spinner.tsx # Loading spinner
â”‚   â”‚   â”œâ”€â”€ component.shortcut.tsx # Keyboard shortcut hint
â”‚   â”‚   â”œâ”€â”€ component.header.tsx  # App header
â”‚   â”‚   â””â”€â”€ component.footer.tsx  # App footer with shortcuts
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ hook.shortcuts.ts     # Keyboard shortcut handling
â”‚   â”‚   â”œâ”€â”€ hook.api.ts           # API data fetching
â”‚   â”‚   â”œâ”€â”€ hook.stream.ts        # SSE subscription
â”‚   â”‚   â”œâ”€â”€ hook.navigation.ts    # Screen navigation
â”‚   â”‚   â””â”€â”€ hook.focus.ts         # Focus management
â”‚   â”‚
â”‚   â””â”€â”€ theme/
â”‚       â”œâ”€â”€ theme.ts              # Color palette and styles
â”‚       â””â”€â”€ theme.context.tsx     # Theme provider
```

## Keyboard Navigation

### Global Shortcuts

| Key       | Action                    |
| --------- | ------------------------- |
| `q`       | Quit application          |
| `?`       | Show help                 |
| `Ctrl+c`  | Force quit                |
| `Escape`  | Go back / Close modal     |
| `Tab`     | Next focusable element    |
| `Shift+Tab` | Previous focusable element |

### Dashboard (Ticket List)

| Key       | Action                    |
| --------- | ------------------------- |
| `â†‘` / `k` | Previous ticket           |
| `â†“` / `j` | Next ticket               |
| `Enter`   | View selected ticket      |
| `n`       | Create new ticket         |
| `a`       | Quick approve (if pending)|
| `r`       | Refresh list              |
| `/`       | Search/filter             |

### Ticket Detail

| Key       | Action                    |
| --------- | ------------------------- |
| `a`       | Approve plan/action       |
| `d`       | Deny action               |
| `c`       | Cancel ticket             |
| `r`       | Resume paused ticket      |
| `l`       | View full audit log       |
| `â†‘` / `â†“` | Scroll content            |

### Forms

| Key          | Action                 |
| ------------ | ---------------------- |
| `Tab`        | Next field             |
| `Shift+Tab`  | Previous field         |
| `Ctrl+Enter` | Submit form            |
| `Escape`     | Cancel/go back         |

## Real-time Updates

The TUI subscribes to SSE streams for live updates:

```typescript
// Subscribe to all ticket events on dashboard
useEffect(() => {
  const unsubscribe = client.subscribeToAll((event) => {
    switch (event.type) {
      case 'status_changed':
        dispatch({ type: 'UPDATE_TICKET', ticket: event.payload.ticket });
        break;
      case 'approval_needed':
        showToast({ type: 'warning', message: `Approval needed: ${event.ticketId}` });
        break;
      // ...
    }
  });
  return unsubscribe;
}, [client]);

// Subscribe to specific ticket on detail view
useEffect(() => {
  const unsubscribe = client.subscribeToTicket(ticketId, (event) => {
    switch (event.type) {
      case 'tool_called':
        addActivityItem(event.payload);
        break;
      case 'argo_health_update':
        updateArgoStatus(event.payload);
        break;
      // ...
    }
  });
  return unsubscribe;
}, [ticketId]);
```

## Color Theme

```typescript
const theme = {
  // Base colors
  primary: '#7C3AED',      // Purple - brand color
  secondary: '#6B7280',    // Gray

  // Status colors
  success: '#10B981',      // Green
  warning: '#F59E0B',      // Amber
  error: '#EF4444',        // Red
  info: '#3B82F6',         // Blue

  // Ticket status
  status: {
    draft: '#9CA3AF',       // Gray
    planning: '#3B82F6',    // Blue
    pending_approval: '#F59E0B', // Amber
    executing: '#7C3AED',   // Purple
    observing: '#06B6D4',   // Cyan
    paused: '#F59E0B',      // Amber
    resolved: '#10B981',    // Green
    failed: '#EF4444',      // Red
    cancelled: '#6B7280',   // Gray
  },

  // UI elements
  border: '#374151',
  background: 'transparent',
  text: '#F9FAFB',
  textMuted: '#9CA3AF',
  selection: '#4C1D95',
};
```

## Implementation Phases

### Phase 1: Foundation âœ…

- [x] Project setup (Ink, Commander)
- [x] CLI argument parsing
- [x] HTTP client with fetch
- [x] Basic state management
- [x] Theme and styling

### Phase 2: Core Screens âœ…

- [x] Dashboard (ticket list)
- [x] Ticket detail view
- [x] Basic navigation
- [x] Keyboard shortcuts

### Phase 3: Interactions âœ…

- [x] Create ticket form
- [x] Approval workflows
- [x] Question answering
- [x] Toast notifications

### Phase 4: Real-time âœ…

- [x] SSE client (HTTP mode)
- [x] Live ticket updates
- [x] Connection status
- [x] Polling fallback (standalone mode)

### Phase 5: Standalone Mode âœ…

- [x] Embedded server
- [x] Direct service access
- [x] Unified client interface

### Phase 6: Polish (Partial)

- [ ] Audit log viewer
- [x] Help screen
- [x] Error handling
- [x] Loading states
- [ ] Search/filter

## Testing Strategy

### Component Tests

```typescript
import { render } from 'ink-testing-library';

test('Badge renders correct status', () => {
  const { lastFrame } = render(<Badge status="executing" />);
  expect(lastFrame()).toContain('â— Executing');
});

test('Table highlights selected row', () => {
  const { lastFrame } = render(
    <Table data={tickets} selectedIndex={1} />
  );
  expect(lastFrame()).toMatchSnapshot();
});
```

### Integration Tests

```typescript
test('can create and view ticket', async () => {
  const { stdin, lastFrame } = render(<App client={mockClient} />);

  // Navigate to create form
  stdin.write('n');
  await waitFor(() => expect(lastFrame()).toContain('Create Ticket'));

  // Fill form
  stdin.write('Test ticket title');
  stdin.write('\t'); // Tab to next field
  stdin.write('Test description');
  stdin.write('\x1b[13~'); // Ctrl+Enter to submit

  await waitFor(() => expect(lastFrame()).toContain('Ticket created'));
});
```

## Dependencies

```json
{
  "dependencies": {
    "ink": "^5.0.0",
    "ink-text-input": "^6.0.0",
    "ink-select-input": "^6.0.0",
    "ink-spinner": "^5.0.0",
    "commander": "^12.0.0",
    "eventsource": "^2.0.0"
  },
  "devDependencies": {
    "@types/react": "^18.0.0",
    "ink-testing-library": "^4.0.0"
  }
}
```

## Example Usage

```bash
# Start TUI connected to local server
aura tui

# Connect to remote server
aura tui --server https://aura.homelab.local:3000

# Run standalone (no external server needed)
aura tui --standalone

# Quick operations without full TUI
aura tickets list
aura tickets create --title "Deploy redis" --description "..."
aura tickets approve abc123
aura tickets show abc123

# Check server status
aura status
```

---

_The TUI brings Aura's power to your terminal with real-time visibility and streamlined workflows._
